{
  "created": 1756626095.343501,
  "duration": 0.18254899978637695,
  "exitcode": 1,
  "root": "/Users/davidboaz/Documents/GitHub/gen_policy_validator",
  "environment": {},
  "summary": {
    "failed": 1,
    "total": 6,
    "collected": 6
  },
  "collectors": [
    {
      "nodeid": "",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py",
          "type": "Module",
          "lineno": null
        }
      ],
      "longrepr": null
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_update_times_preserve_details",
          "type": "Function",
          "lineno": 8
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_basic_economy_unmodifiable",
          "type": "Function",
          "lineno": 36
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_origin_change_violation",
          "type": "Function",
          "lineno": 65
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_destination_change_violation",
          "type": "Function",
          "lineno": 94
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_trip_type_change_violation",
          "type": "Function",
          "lineno": 123
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_no_price_verification_violation",
          "type": "Function",
          "lineno": 152
        }
      ],
      "longrepr": null
    }
  ],
  "tests": [
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_update_times_preserve_details",
      "lineno": 8,
      "outcome": "failed",
      "keywords": [
        "test_update_times_preserve_details",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.0009508337825536728,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0023985421285033226,
        "outcome": "failed",
        "crash": {
          "path": "/Users/davidboaz/Documents/GitHub/gen_policy_validator/eval/airline/output/2025-08-31_10_38_30/airline/update_reservation_flights/guard_flight_modification_api_limitation_check.py",
          "lineno": 54,
          "message": "rt_toolguard.data_types.PolicyViolationException: Origin must remain unchanged."
        },
        "traceback": [
          {
            "path": "tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py",
            "lineno": 35,
            "message": ""
          },
          {
            "path": "airline/update_reservation_flights/guard_flight_modification_api_limitation_check.py",
            "lineno": 54,
            "message": "PolicyViolationException"
          }
        ],
        "longrepr": "def test_update_times_preserve_details():\n        \"\"\"\n        Policy: \"Agents must verify the following before using the Flight Modification API: Basic economy flights are unmodifiable. For other flight reservations, ensure that origin, destination, and trip type remain unchanged from the initial booking. Prices for flight segments retained stay at original rates, not updated by the API. Manual validation of segment prices is required.\"\n        Example: \"An agent updates a reservation by changing the flight times while preserving the original cabin class, origin, destination, and trip type, complying with the policy requirements.\"\n        \"\"\"\n        api = MagicMock(spec=I_Airline)\n        reservation = Reservation(\n            reservation_id=\"ABC123\",\n            user_id=\"user1\",\n            origin=\"SFO\",\n            destination=\"JFK\",\n            flight_type=\"round_trip\",\n            cabin=\"business\",\n            flights=[ReservationFlight(flight_number=\"FL123\", origin=\"SFO\", destination=\"JFK\", date=\"2024-06-01\", price=500)],\n            passengers=[],\n            payment_history=[],\n            created_at=datetime.now().strftime(\"%Y-%m-%dT%H:%M:%S\"),\n            total_baggages=1,\n            nonfree_baggages=0,\n            insurance=\"no\",\n            status=None\n        )\n        api.get_reservation_details.side_effect = lambda rid: reservation if rid == \"ABC123\" else None\n        api.get_flight_instance.side_effect = lambda fn, date: FlightDateStatusAvailable(status=\"available\", available_seats={\"business\": 5, \"economy\": 5, \"basic_economy\": 5}, prices={\"business\": 500, \"economy\": 300, \"basic_economy\": 200})\n    \n        flights = [FlightInfo(flight_number=\"FL123\", date=\"2024-06-01\")]\n>       guard_flight_modification_api_limitation_check(api, reservation_id=\"ABC123\", cabin=\"business\", flights=flights, payment_id=\"credit_card_123\")\n\ntests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py:35: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\napi = <MagicMock spec='I_Airline' id='4427464096'>, reservation_id = 'ABC123', cabin = 'business'\nflights = [FlightInfo(flight_number='FL123', date='2024-06-01')], payment_id = 'credit_card_123'\n\n    def guard_flight_modification_api_limitation_check(api: I_Airline, reservation_id: str, cabin: Literal['business', 'economy', 'basic_economy'], flights: list[FlightInfo | dict], payment_id: str):\n        \"\"\"\n        Policy to check: Agents must verify the following before using the Flight Modification API:\n        - Basic economy flights are unmodifiable.\n        - For other flight reservations, ensure that origin, destination, and trip type remain unchanged from the initial booking.\n        - Prices for flight segments retained stay at original rates, not updated by the API. Manual validation of segment prices is required.\n        \"\"\"\n        # Retrieve the original reservation details\n        reservation = api.get_reservation_details(reservation_id)\n    \n        # 1. Basic economy flights are unmodifiable\n        if reservation.cabin == 'basic_economy':\n            raise PolicyViolationException(\"Basic economy flights cannot be modified.\")\n    \n        # 2. Ensure origin, destination, and trip type remain unchanged\n        if reservation.origin != reservation.origin:  # This is redundant, but we compare with new flights\n            raise PolicyViolationException(\"Origin must remain unchanged.\")\n        if reservation.destination != reservation.destination:\n            raise PolicyViolationException(\"Destination must remain unchanged.\")\n        if reservation.flight_type != reservation.flight_type:\n            raise PolicyViolationException(\"Trip type must remain unchanged.\")\n    \n        # Extract origin/destination from new flights to compare\n        if flights:\n            # Get the first and last flight info from the new flights list\n            first_flight_info = flights[0]\n            last_flight_info = flights[-1]\n            if isinstance(first_flight_info, dict):\n                first_flight_number = first_flight_info.get('flight_number')\n                first_flight_date = first_flight_info.get('date')\n            else:\n                first_flight_number = first_flight_info.flight_number\n                first_flight_date = first_flight_info.date\n    \n            if isinstance(last_flight_info, dict):\n                last_flight_number = last_flight_info.get('flight_number')\n                last_flight_date = last_flight_info.get('date')\n            else:\n                last_flight_number = last_flight_info.flight_number\n                last_flight_date = last_flight_info.date\n    \n            # Get scheduled flights to determine origin/destination\n            first_scheduled = api.get_scheduled_flight(first_flight_number)\n            last_scheduled = api.get_scheduled_flight(last_flight_number)\n    \n            if first_scheduled.origin != reservation.origin:\n>               raise PolicyViolationException(\"Origin must remain unchanged.\")\nE               rt_toolguard.data_types.PolicyViolationException: Origin must remain unchanged.\n\nairline/update_reservation_flights/guard_flight_modification_api_limitation_check.py:54: PolicyViolationException"
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Agents must verify the following before using the Flight Modification API: Basic economy flights are unmodifiable. For other flight reservations, ensure that origin, destination, and trip type remain unchanged from the initial booking. Prices for flight segments retained stay at original rates, not updated by the API. Manual validation of segment prices is required.\"\n    Example: \"An agent updates a reservation by changing the flight times while preserving the original cabin class, origin, destination, and trip type, complying with the policy requirements.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.00017954129725694656,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_basic_economy_unmodifiable",
      "lineno": 36,
      "outcome": "passed",
      "keywords": [
        "test_basic_economy_unmodifiable",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.00010866718366742134,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0007322910241782665,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Basic economy flights are unmodifiable.\"\n    Example: \"An agent attempts to use the Flight Modification API to change the cabin class of a reservation booked under 'basic_economy'.\"\n    "
        }
      ],
      "teardown": {
        "duration": 9.133294224739075e-05,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_origin_change_violation",
      "lineno": 65,
      "outcome": "passed",
      "keywords": [
        "test_origin_change_violation",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 8.687516674399376e-05,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0009122500196099281,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Origin must remain unchanged.\"\n    Example: \"The agent changes the origin from 'SFO' to 'LAX' in a reservation update.\"\n    "
        }
      ],
      "teardown": {
        "duration": 9.433412924408913e-05,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_destination_change_violation",
      "lineno": 94,
      "outcome": "passed",
      "keywords": [
        "test_destination_change_violation",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 9.50000248849392e-05,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0008901660330593586,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Destination must remain unchanged.\"\n    Example: \"Changing the destination from 'JFK' to 'BOS' during a reservation update.\"\n    "
        }
      ],
      "teardown": {
        "duration": 9.970832616090775e-05,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_trip_type_change_violation",
      "lineno": 123,
      "outcome": "passed",
      "keywords": [
        "test_trip_type_change_violation",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 8.974969387054443e-05,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0008587497286498547,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Trip type must remain unchanged.\"\n    Example: \"An agent updates a flight reservation from a 'round_trip' to a 'one_way' trip.\"\n    "
        }
      ],
      "teardown": {
        "duration": 9.925011545419693e-05,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_flight_modification_api_limitation_check.py::test_no_price_verification_violation",
      "lineno": 152,
      "outcome": "passed",
      "keywords": [
        "test_no_price_verification_violation",
        "test_guard_flight_modification_api_limitation_check.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 9.1583002358675e-05,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0008379998616874218,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Manual validation of segment prices is required.\"\n    Example: \"An agent uses the API to modify a flight reservation without manually verifying the prices of retained flight segments.\"\n    "
        }
      ],
      "teardown": {
        "duration": 8.829217404127121e-05,
        "outcome": "passed"
      }
    }
  ]
}