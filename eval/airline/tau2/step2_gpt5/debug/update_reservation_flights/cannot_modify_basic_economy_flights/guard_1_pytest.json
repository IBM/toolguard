{
  "created": 1756626077.2223349,
  "duration": 0.1585216522216797,
  "exitcode": 1,
  "root": "/Users/davidboaz/Documents/GitHub/gen_policy_validator",
  "environment": {},
  "summary": {
    "failed": 1,
    "total": 3,
    "collected": 3
  },
  "collectors": [
    {
      "nodeid": "",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py",
          "type": "Module",
          "lineno": null
        }
      ],
      "longrepr": null
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_update_business_reservation_same_route",
          "type": "Function",
          "lineno": 8
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_change_basic_economy_origin_destination",
          "type": "Function",
          "lineno": 42
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_change_trip_type_for_economy",
          "type": "Function",
          "lineno": 77
        }
      ],
      "longrepr": null
    }
  ],
  "tests": [
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_update_business_reservation_same_route",
      "lineno": 8,
      "outcome": "failed",
      "keywords": [
        "test_update_business_reservation_same_route",
        "test_guard_cannot_modify_basic_economy_flights.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.0008647083304822445,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0008367081172764301,
        "outcome": "failed",
        "crash": {
          "path": "/Users/davidboaz/Documents/GitHub/gen_policy_validator/eval/airline/output/2025-08-31_10_38_30/airline/update_reservation_flights/guard_cannot_modify_basic_economy_flights.py",
          "lineno": 51,
          "message": "rt_toolguard.data_types.PolicyViolationException: Trip type cannot be changed for non-basic economy reservations."
        },
        "traceback": [
          {
            "path": "tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py",
            "lineno": 41,
            "message": ""
          },
          {
            "path": "airline/update_reservation_flights/guard_cannot_modify_basic_economy_flights.py",
            "lineno": 51,
            "message": "PolicyViolationException"
          }
        ],
        "longrepr": "def test_update_business_reservation_same_route():\n        \"\"\"\n        Policy: \"Basic economy flights in a reservation cannot be modified at all. For reservations that are not classified as basic economy, modifications are allowed but must not change the origin, destination, or trip type.\"\n        Example: \"An agent successfully updates a 'business' reservation by changing the flight times, keeping the same origin 'SFO' and destination 'JFK' without altering the trip type from 'round_trip', ensuring compliance with the policy.\"\n        \"\"\"\n        api = MagicMock(spec=I_Airline)\n        reservation = Reservation(\n            reservation_id=\"RES123\",\n            user_id=\"USER1\",\n            origin=\"SFO\",\n            destination=\"JFK\",\n            flight_type=\"round_trip\",\n            cabin=\"business\",\n            flights=[ReservationFlight(flight_number=\"FL123\", date=\"2024-06-01\", price=500, origin=\"SFO\", destination=\"JFK\")],\n            passengers=[],\n            payment_history=[],\n            created_at=datetime.now().strftime(\"%Y-%m-%dT%H:%M:%S\"),\n            total_baggages=1,\n            nonfree_baggages=0,\n            insurance=\"no\",\n            status=None\n        )\n        api.get_reservation_details.side_effect = lambda rid: reservation if rid == \"RES123\" else None\n        api.get_scheduled_flight.side_effect = lambda fn: Flight(\n            flight_number=fn,\n            origin=\"SFO\",\n            destination=\"JFK\",\n            scheduled_departure_time_est=\"06:00:00\",\n            scheduled_arrival_time_est=\"14:00:00\",\n            dates={}\n        )\n        flights = [FlightInfo(flight_number=\"FL123\", date=\"2024-06-01\")]\n>       guard_cannot_modify_basic_economy_flights(api, \"RES123\", \"business\", flights, \"pay123\")\n\ntests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py:41: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\napi = <MagicMock spec='I_Airline' id='4387278336'>, reservation_id = 'RES123', cabin = 'business'\nflights = [FlightInfo(flight_number='FL123', date='2024-06-01')], payment_id = 'pay123'\n\n    def guard_cannot_modify_basic_economy_flights(api: I_Airline, reservation_id: str, cabin: Literal['business', 'economy', 'basic_economy'], flights: list[FlightInfo | dict], payment_id: str):\n        \"\"\"\n        Policy to check: Basic economy flights in a reservation cannot be modified at all. For reservations that are not classified as basic economy, modifications are allowed but must not change the origin, destination, or trip type.\n        \"\"\"\n        # Retrieve the current reservation details\n        reservation = api.get_reservation_details(reservation_id)\n    \n        # If the reservation is basic economy, no modifications are allowed\n        if reservation.cabin == 'basic_economy':\n            raise PolicyViolationException(\"Basic economy flights cannot be modified.\")\n    \n        # For non-basic economy reservations, ensure origin, destination, and trip type remain unchanged\n        if reservation.origin != reservation.origin or reservation.destination != reservation.destination or reservation.flight_type != reservation.flight_type:\n            # This check above is incorrect; we need to compare with the new flights' details\n            pass\n    \n        # Determine the origin and destination from the new flights\n        if not flights:\n            return  # No flights provided, nothing to check\n    \n        # Get scheduled flight details for the first and last flights in the new itinerary\n        first_flight_info = flights[0]\n        last_flight_info = flights[-1]\n    \n        if isinstance(first_flight_info, dict):\n            first_flight_info = FlightInfo(**first_flight_info)\n        if isinstance(last_flight_info, dict):\n            last_flight_info = FlightInfo(**last_flight_info)\n    \n        first_flight_schedule = api.get_scheduled_flight(first_flight_info.flight_number)\n        last_flight_schedule = api.get_scheduled_flight(last_flight_info.flight_number)\n    \n        new_origin = first_flight_schedule.origin\n        new_destination = last_flight_schedule.destination\n    \n        if reservation.origin != new_origin:\n            raise PolicyViolationException(\"Origin cannot be changed for non-basic economy reservations.\")\n        if reservation.destination != new_destination:\n            raise PolicyViolationException(\"Destination cannot be changed for non-basic economy reservations.\")\n    \n        # Trip type check: round_trip means first flight origin == last flight destination\n        new_trip_type = 'round_trip' if new_origin == new_destination else 'one_way'\n        if reservation.flight_type != new_trip_type:\n>           raise PolicyViolationException(\"Trip type cannot be changed for non-basic economy reservations.\")\nE           rt_toolguard.data_types.PolicyViolationException: Trip type cannot be changed for non-basic economy reservations.\n\nairline/update_reservation_flights/guard_cannot_modify_basic_economy_flights.py:51: PolicyViolationException"
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Basic economy flights in a reservation cannot be modified at all. For reservations that are not classified as basic economy, modifications are allowed but must not change the origin, destination, or trip type.\"\n    Example: \"An agent successfully updates a 'business' reservation by changing the flight times, keeping the same origin 'SFO' and destination 'JFK' without altering the trip type from 'round_trip', ensuring compliance with the policy.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.00023583369329571724,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_change_basic_economy_origin_destination",
      "lineno": 42,
      "outcome": "passed",
      "keywords": [
        "test_change_basic_economy_origin_destination",
        "test_guard_cannot_modify_basic_economy_flights.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.00012587476521730423,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.000837292056530714,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"Basic economy flights in a reservation cannot be modified at all.\"\n    Example: \"A user attempts to change a reservation with basic economy flights by providing a new itinerary with updated origin and destination details, violating the restriction on modifying basic economy flights.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.00010254187509417534,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/update_reservation_flights/test_guard_cannot_modify_basic_economy_flights.py::test_change_trip_type_for_economy",
      "lineno": 77,
      "outcome": "passed",
      "keywords": [
        "test_change_trip_type_for_economy",
        "test_guard_cannot_modify_basic_economy_flights.py",
        "update_reservation_flights",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 9.224982932209969e-05,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0006062090396881104,
        "outcome": "passed",
        "crash": null,
        "traceback": null,
        "longrepr": null
      },
      "user_properties": [
        {
          "docstring": " \n    Policy: \"For reservations that are not classified as basic economy, modifications are allowed but must not change the origin, destination, or trip type.\"\n    Example: \"An agent attempts to update a reservation classified as 'economy' by changing the trip type from 'round_trip' to 'one_way', which violates the policy of maintaining trip type for non-basic reservations.\"\n    "
        }
      ],
      "teardown": {
        "duration": 9.254086762666702e-05,
        "outcome": "passed"
      }
    }
  ]
}