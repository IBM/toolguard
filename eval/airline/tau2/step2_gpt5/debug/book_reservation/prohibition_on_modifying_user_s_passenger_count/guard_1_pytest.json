{
  "created": 1756626054.901112,
  "duration": 0.15708708763122559,
  "exitcode": 1,
  "root": "/Users/davidboaz/Documents/GitHub/gen_policy_validator",
  "environment": {},
  "summary": {
    "failed": 3,
    "total": 3,
    "collected": 3
  },
  "collectors": [
    {
      "nodeid": "",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py",
          "type": "Module",
          "lineno": null
        }
      ],
      "longrepr": null
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py",
      "outcome": "passed",
      "result": [
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_update_passenger_details_without_count_change",
          "type": "Function",
          "lineno": 8
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_attempt_to_increase_passenger_count",
          "type": "Function",
          "lineno": 61
        },
        {
          "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_attempt_to_decrease_passenger_count",
          "type": "Function",
          "lineno": 112
        }
      ],
      "longrepr": null
    }
  ],
  "tests": [
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_update_passenger_details_without_count_change",
      "lineno": 8,
      "outcome": "failed",
      "keywords": [
        "test_update_passenger_details_without_count_change",
        "test_guard_prohibition_on_modifying_user_s_passenger_count.py",
        "book_reservation",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.000936875119805336,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.0017950418405234814,
        "outcome": "failed",
        "crash": {
          "path": "/Users/davidboaz/Documents/GitHub/gen_policy_validator/eval/airline/output/2025-08-31_10_38_30/airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
          "lineno": 40,
          "message": "AttributeError: 'NoneType' object has no attribute 'passengers'"
        },
        "traceback": [
          {
            "path": "tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 45,
            "message": ""
          },
          {
            "path": "airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 40,
            "message": "AttributeError"
          }
        ],
        "longrepr": "def test_update_passenger_details_without_count_change():\n        \"\"\"\n        Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n        Example: \"An agent updates passengers' details such as name spelling, date of birth, or contact information without changing the established number of passengers in the reservation.\"\n        \"\"\"\n        api = MagicMock(spec=I_Airline)\n    \n        # Existing reservation with 2 passengers\n        existing_reservation = Reservation(\n            reservation_id=\"RES123\",\n            user_id=\"user_001\",\n            origin=\"SFO\",\n            destination=\"JFK\",\n            flight_type=\"round_trip\",\n            cabin=\"economy\",\n            flights=[ReservationFlight(flight_number=\"FL123\", origin=\"SFO\", destination=\"JFK\", date=\"2024-06-01\", price=300)],\n            passengers=[\n                Passenger(first_name=\"John\", last_name=\"Doe\", dob=\"1990-01-01\"),\n                Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\")\n            ],\n            payment_history=[Payment(payment_id=\"pay_001\", amount=600)],\n            created_at=(datetime.now() - timedelta(days=10)).strftime(\"%Y-%m-%dT%H:%M:%S\"),\n            total_baggages=2,\n            nonfree_baggages=1,\n            insurance=\"yes\",\n            status=None\n        )\n    \n        api.get_reservation_details.side_effect = lambda reservation_id: existing_reservation if reservation_id == \"RES123\" else None\n    \n        updated_passengers = [\n            Passenger(first_name=\"Johnathan\", last_name=\"Doe\", dob=\"1990-01-01\"),\n            Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\")\n        ]\n    \n        try:\n>           guard_prohibition_on_modifying_user_s_passenger_count(\n                api,\n                user_id=\"user_001\",\n                origin=\"SFO\",\n                destination=\"JFK\",\n                flight_type=\"round_trip\",\n                cabin=\"economy\",\n                flights=[FlightInfo(flight_number=\"FL123\", date=\"2024-06-01\")],\n                passengers=updated_passengers,\n                payment_methods=[Payment(payment_id=\"pay_001\", amount=600)],\n                total_baggages=2,\n                nonfree_baggages=1,\n                insurance=\"yes\"\n            )\n\ntests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py:45: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\napi = <MagicMock spec='I_Airline' id='4434031008'>, user_id = 'user_001', origin = 'SFO', destination = 'JFK'\nflight_type = 'round_trip', cabin = 'economy', flights = [FlightInfo(flight_number='FL123', date='2024-06-01')]\npassengers = [Passenger(first_name='Johnathan', last_name='Doe', dob='1990-01-01'), Passenger(first_name='Jane', last_name='Doe', dob='1992-02-02')]\npayment_methods = [Payment(payment_id='pay_001', amount=600)], total_baggages = 2, nonfree_baggages = 1\ninsurance = 'yes'\n\n    def guard_prohibition_on_modifying_user_s_passenger_count(\n        api: I_Airline,\n        user_id: str,\n        origin: str,\n        destination: str,\n        flight_type: Literal['round_trip', 'one_way'],\n        cabin: Literal['business', 'economy', 'basic_economy'],\n        flights: list[FlightInfo],\n        passengers: list[Passenger | dict],\n        payment_methods: list[Payment | dict],\n        total_baggages: int,\n        nonfree_baggages: int,\n        insurance: Literal['yes', 'no']\n    ):\n        \"\"\"\n        Policy to check: The agent must not alter the number of passengers in a reservation once established,\n        though modifications to passenger details like name or date of birth are allowed.\n    \n        This guard will fetch the existing reservation details for the user and compare the passenger count\n        with the new request. If the count differs, it will raise a PolicyViolationException.\n        \"\"\"\n        # Retrieve user details to find their reservations\n        user_details = api.get_user_details(user_id)\n        if not user_details.reservations:\n            # No existing reservations, so no passenger count to compare against\n            return\n    \n        # For simplicity, assume the policy applies to the most recent reservation\n        # (In a real-world scenario, we might need a reservation_id parameter to be explicit)\n        latest_reservation_id = user_details.reservations[-1]\n        existing_reservation = api.get_reservation_details(latest_reservation_id)\n    \n>       existing_count = len(existing_reservation.passengers)\nE       AttributeError: 'NoneType' object has no attribute 'passengers'\n\nairline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py:40: AttributeError"
      },
      "user_properties": [
        {
          "docstring": "\n    Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n    Example: \"An agent updates passengers' details such as name spelling, date of birth, or contact information without changing the established number of passengers in the reservation.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.0002562091685831547,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_attempt_to_increase_passenger_count",
      "lineno": 61,
      "outcome": "failed",
      "keywords": [
        "test_attempt_to_increase_passenger_count",
        "test_guard_prohibition_on_modifying_user_s_passenger_count.py",
        "book_reservation",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.0003659999929368496,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.001247250009328127,
        "outcome": "failed",
        "crash": {
          "path": "/Users/davidboaz/Documents/GitHub/gen_policy_validator/eval/airline/output/2025-08-31_10_38_30/airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
          "lineno": 40,
          "message": "AttributeError: 'NoneType' object has no attribute 'passengers'"
        },
        "traceback": [
          {
            "path": "tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 98,
            "message": ""
          },
          {
            "path": "airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 40,
            "message": "AttributeError"
          }
        ],
        "longrepr": "def test_attempt_to_increase_passenger_count():\n        \"\"\"\n        Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n        Example: \"An agent attempts to alter the number of passengers in a reservation by changing the count, such as from 2 to 3, violating the policy of immutability on passenger count.\"\n        \"\"\"\n        api = MagicMock(spec=I_Airline)\n    \n        existing_reservation = Reservation(\n            reservation_id=\"RES123\",\n            user_id=\"user_001\",\n            origin=\"SFO\",\n            destination=\"JFK\",\n            flight_type=\"round_trip\",\n            cabin=\"economy\",\n            flights=[ReservationFlight(flight_number=\"FL123\", origin=\"SFO\", destination=\"JFK\", date=\"2024-06-01\", price=300)],\n            passengers=[\n                Passenger(first_name=\"John\", last_name=\"Doe\", dob=\"1990-01-01\"),\n                Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\")\n            ],\n            payment_history=[Payment(payment_id=\"pay_001\", amount=600)],\n            created_at=(datetime.now() - timedelta(days=10)).strftime(\"%Y-%m-%dT%H:%M:%S\"),\n            total_baggages=2,\n            nonfree_baggages=1,\n            insurance=\"yes\",\n            status=None\n        )\n    \n        api.get_reservation_details.side_effect = lambda reservation_id: existing_reservation if reservation_id == \"RES123\" else None\n    \n        increased_passengers = [\n            Passenger(first_name=\"John\", last_name=\"Doe\", dob=\"1990-01-01\"),\n            Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\"),\n            Passenger(first_name=\"Jim\", last_name=\"Beam\", dob=\"1985-03-03\")\n        ]\n    \n        with pytest.raises(PolicyViolationException):\n>           guard_prohibition_on_modifying_user_s_passenger_count(\n                api,\n                user_id=\"user_001\",\n                origin=\"SFO\",\n                destination=\"JFK\",\n                flight_type=\"round_trip\",\n                cabin=\"economy\",\n                flights=[FlightInfo(flight_number=\"FL123\", date=\"2024-06-01\")],\n                passengers=increased_passengers,\n                payment_methods=[Payment(payment_id=\"pay_001\", amount=600)],\n                total_baggages=2,\n                nonfree_baggages=1,\n                insurance=\"yes\"\n            )\n\ntests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py:98: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\napi = <MagicMock spec='I_Airline' id='4433631024'>, user_id = 'user_001', origin = 'SFO', destination = 'JFK'\nflight_type = 'round_trip', cabin = 'economy', flights = [FlightInfo(flight_number='FL123', date='2024-06-01')]\npassengers = [Passenger(first_name='John', last_name='Doe', dob='1990-01-01'), Passenger(first_name='Jane', last_name='Doe', dob='1992-02-02'), Passenger(first_name='Jim', last_name='Beam', dob='1985-03-03')]\npayment_methods = [Payment(payment_id='pay_001', amount=600)], total_baggages = 2, nonfree_baggages = 1\ninsurance = 'yes'\n\n    def guard_prohibition_on_modifying_user_s_passenger_count(\n        api: I_Airline,\n        user_id: str,\n        origin: str,\n        destination: str,\n        flight_type: Literal['round_trip', 'one_way'],\n        cabin: Literal['business', 'economy', 'basic_economy'],\n        flights: list[FlightInfo],\n        passengers: list[Passenger | dict],\n        payment_methods: list[Payment | dict],\n        total_baggages: int,\n        nonfree_baggages: int,\n        insurance: Literal['yes', 'no']\n    ):\n        \"\"\"\n        Policy to check: The agent must not alter the number of passengers in a reservation once established,\n        though modifications to passenger details like name or date of birth are allowed.\n    \n        This guard will fetch the existing reservation details for the user and compare the passenger count\n        with the new request. If the count differs, it will raise a PolicyViolationException.\n        \"\"\"\n        # Retrieve user details to find their reservations\n        user_details = api.get_user_details(user_id)\n        if not user_details.reservations:\n            # No existing reservations, so no passenger count to compare against\n            return\n    \n        # For simplicity, assume the policy applies to the most recent reservation\n        # (In a real-world scenario, we might need a reservation_id parameter to be explicit)\n        latest_reservation_id = user_details.reservations[-1]\n        existing_reservation = api.get_reservation_details(latest_reservation_id)\n    \n>       existing_count = len(existing_reservation.passengers)\nE       AttributeError: 'NoneType' object has no attribute 'passengers'\n\nairline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py:40: AttributeError"
      },
      "user_properties": [
        {
          "docstring": "\n    Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n    Example: \"An agent attempts to alter the number of passengers in a reservation by changing the count, such as from 2 to 3, violating the policy of immutability on passenger count.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.0001848749816417694,
        "outcome": "passed"
      }
    },
    {
      "nodeid": "eval/airline/output/2025-08-31_10_38_30/tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py::test_attempt_to_decrease_passenger_count",
      "lineno": 112,
      "outcome": "failed",
      "keywords": [
        "test_attempt_to_decrease_passenger_count",
        "test_guard_prohibition_on_modifying_user_s_passenger_count.py",
        "book_reservation",
        "tests",
        "2025-08-31_10_38_30",
        "output",
        "airline",
        "eval",
        "gen_policy_validator",
        ""
      ],
      "setup": {
        "duration": 0.00010679196566343307,
        "outcome": "passed"
      },
      "call": {
        "duration": 0.001141624990850687,
        "outcome": "failed",
        "crash": {
          "path": "/Users/davidboaz/Documents/GitHub/gen_policy_validator/eval/airline/output/2025-08-31_10_38_30/airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
          "lineno": 40,
          "message": "AttributeError: 'NoneType' object has no attribute 'passengers'"
        },
        "traceback": [
          {
            "path": "tests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 153,
            "message": ""
          },
          {
            "path": "airline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py",
            "lineno": 40,
            "message": "AttributeError"
          }
        ],
        "longrepr": "def test_attempt_to_decrease_passenger_count():\n        \"\"\"\n        Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n        Example: \"The reservation system allows an agent to add or remove passengers, such as reducing the passenger count established from 5 to 4, thereby violating the no-alteration policy.\"\n        \"\"\"\n        api = MagicMock(spec=I_Airline)\n    \n        existing_reservation = Reservation(\n            reservation_id=\"RES123\",\n            user_id=\"user_001\",\n            origin=\"SFO\",\n            destination=\"JFK\",\n            flight_type=\"round_trip\",\n            cabin=\"economy\",\n            flights=[ReservationFlight(flight_number=\"FL123\", origin=\"SFO\", destination=\"JFK\", date=\"2024-06-01\", price=300)],\n            passengers=[\n                Passenger(first_name=\"John\", last_name=\"Doe\", dob=\"1990-01-01\"),\n                Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\"),\n                Passenger(first_name=\"Jim\", last_name=\"Beam\", dob=\"1985-03-03\"),\n                Passenger(first_name=\"Jack\", last_name=\"Daniels\", dob=\"1980-04-04\"),\n                Passenger(first_name=\"Johnny\", last_name=\"Walker\", dob=\"1975-05-05\")\n            ],\n            payment_history=[Payment(payment_id=\"pay_001\", amount=1500)],\n            created_at=(datetime.now() - timedelta(days=10)).strftime(\"%Y-%m-%dT%H:%M:%S\"),\n            total_baggages=5,\n            nonfree_baggages=3,\n            insurance=\"yes\",\n            status=None\n        )\n    \n        api.get_reservation_details.side_effect = lambda reservation_id: existing_reservation if reservation_id == \"RES123\" else None\n    \n        decreased_passengers = [\n            Passenger(first_name=\"John\", last_name=\"Doe\", dob=\"1990-01-01\"),\n            Passenger(first_name=\"Jane\", last_name=\"Doe\", dob=\"1992-02-02\"),\n            Passenger(first_name=\"Jim\", last_name=\"Beam\", dob=\"1985-03-03\"),\n            Passenger(first_name=\"Jack\", last_name=\"Daniels\", dob=\"1980-04-04\")\n        ]\n    \n        with pytest.raises(PolicyViolationException):\n>           guard_prohibition_on_modifying_user_s_passenger_count(\n                api,\n                user_id=\"user_001\",\n                origin=\"SFO\",\n                destination=\"JFK\",\n                flight_type=\"round_trip\",\n                cabin=\"economy\",\n                flights=[FlightInfo(flight_number=\"FL123\", date=\"2024-06-01\")],\n                passengers=decreased_passengers,\n                payment_methods=[Payment(payment_id=\"pay_001\", amount=1200)],\n                total_baggages=4,\n                nonfree_baggages=2,\n                insurance=\"yes\"\n            )\n\ntests/book_reservation/test_guard_prohibition_on_modifying_user_s_passenger_count.py:153: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\napi = <MagicMock spec='I_Airline' id='4433353120'>, user_id = 'user_001', origin = 'SFO', destination = 'JFK'\nflight_type = 'round_trip', cabin = 'economy', flights = [FlightInfo(flight_number='FL123', date='2024-06-01')]\npassengers = [Passenger(first_name='John', last_name='Doe', dob='1990-01-01'), Passenger(first_name='Jane', last_name='Doe', dob='1...t_name='Jim', last_name='Beam', dob='1985-03-03'), Passenger(first_name='Jack', last_name='Daniels', dob='1980-04-04')]\npayment_methods = [Payment(payment_id='pay_001', amount=1200)], total_baggages = 4, nonfree_baggages = 2\ninsurance = 'yes'\n\n    def guard_prohibition_on_modifying_user_s_passenger_count(\n        api: I_Airline,\n        user_id: str,\n        origin: str,\n        destination: str,\n        flight_type: Literal['round_trip', 'one_way'],\n        cabin: Literal['business', 'economy', 'basic_economy'],\n        flights: list[FlightInfo],\n        passengers: list[Passenger | dict],\n        payment_methods: list[Payment | dict],\n        total_baggages: int,\n        nonfree_baggages: int,\n        insurance: Literal['yes', 'no']\n    ):\n        \"\"\"\n        Policy to check: The agent must not alter the number of passengers in a reservation once established,\n        though modifications to passenger details like name or date of birth are allowed.\n    \n        This guard will fetch the existing reservation details for the user and compare the passenger count\n        with the new request. If the count differs, it will raise a PolicyViolationException.\n        \"\"\"\n        # Retrieve user details to find their reservations\n        user_details = api.get_user_details(user_id)\n        if not user_details.reservations:\n            # No existing reservations, so no passenger count to compare against\n            return\n    \n        # For simplicity, assume the policy applies to the most recent reservation\n        # (In a real-world scenario, we might need a reservation_id parameter to be explicit)\n        latest_reservation_id = user_details.reservations[-1]\n        existing_reservation = api.get_reservation_details(latest_reservation_id)\n    \n>       existing_count = len(existing_reservation.passengers)\nE       AttributeError: 'NoneType' object has no attribute 'passengers'\n\nairline/book_reservation/guard_prohibition_on_modifying_user_s_passenger_count.py:40: AttributeError"
      },
      "user_properties": [
        {
          "docstring": "\n    Policy: \"The agent must not alter the number of passengers in a reservation once established, though modifications to passenger details like name or date of birth are allowed.\"\n    Example: \"The reservation system allows an agent to add or remove passengers, such as reducing the passenger count established from 5 to 4, thereby violating the no-alteration policy.\"\n    "
        }
      ],
      "teardown": {
        "duration": 0.00015254225581884384,
        "outcome": "passed"
      }
    }
  ]
}